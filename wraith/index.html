<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wraith Wheels â€” The Night Watcher</title>
  <link rel="stylesheet" href="styles.css?v=12">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
</head>
<body>
  <!-- Animated background elements -->
  <div class="bg-animation">
    <div class="floating-ghost ghost-1">ğŸ‘»</div>
    <div class="floating-ghost ghost-2">ğŸ¦‡</div>
    <div class="floating-ghost ghost-3">ğŸ‘»</div>
    <div class="fog"></div>
  </div>

  <header>
    <div class="moon">ğŸŒ•</div>
    <h1 class="spooky-title">
      <span class="icon-float">ğŸƒ</span>
      WRAITH WHEELS
      <span class="icon-float">ğŸ¦‡</span>
    </h1>
    <p class="subtitle glitch" data-text="The Night Watcher">The Night Watcher</p>
    <p class="tagline">Stay awake... or face the pumpkin's curse ğŸ’€</p>
  </header>

  <main>
    <div class="container">
      <!-- Sidebar Controls -->
      <aside class="sidebar">
        <div class="control-section">
          <div class="action-buttons">
            <button id="startBtn" class="btn-primary">
              <span class="btn-icon">ğŸ•¯ï¸</span>
              AWAKEN
            </button>
            <button id="stopBtn" class="btn-secondary" disabled>
              <span class="btn-icon">âš°ï¸</span>
              REST
            </button>
          </div>
        </div>

        <!-- Basic Settings -->
        <details class="accordion" open>
          <summary class="accordion-header">
            <span class="accordion-icon">ğŸ‘ï¸</span>
            <span>Basic Detection</span>
          </summary>
          <div class="accordion-content">
            <div class="control">
              <label for="threshold">Eye Threshold <span id="thresholdVal" class="value-badge">0.24</span></label>
              <input type="range" id="threshold" min="0.12" max="0.35" step="0.01" value="0.24" />
            </div>
            <div class="control">
              <label for="duration">Closed Duration (sec) <span id="durationVal" class="value-badge">1.5</span></label>
              <input type="range" id="duration" min="0.5" max="3.0" step="0.1" value="1.5" />
            </div>
            <div class="control">
              <label for="hideDelay">Pumpkin Hide Delay (sec) <span id="hideDelayVal" class="value-badge">0.40</span></label>
              <input type="range" id="hideDelay" min="0.0" max="2.0" step="0.05" value="0.40" />
            </div>
          </div>
        </details>

        <!-- CNN Settings -->
        <details class="accordion">
          <summary class="accordion-header">
            <span class="accordion-icon">ğŸ§ </span>
            <span>AI Vision (CNN)</span>
          </summary>
          <div class="accordion-content">
            <div class="control checkbox-control">
              <label class="switch">
                <input type="checkbox" id="useCnn" />
                <span class="slider"></span>
              </label>
              <span>Enable CNN Eye Classifier</span>
            </div>
            <div class="control">
              <label for="cnnThresh">CNN Closed Prob <span id="cnnThreshVal" class="value-badge">0.60</span></label>
              <input type="range" id="cnnThresh" min="0.30" max="0.90" step="0.01" value="0.60" />
            </div>
            <div class="control">
              <label for="cnnPumpkinDelay">CNN Pumpkin Delay (sec) <span id="cnnPumpkinDelayVal" class="value-badge">2.0</span></label>
              <input type="range" id="cnnPumpkinDelay" min="0.0" max="5.0" step="0.1" value="2.0" />
            </div>
            <div class="control checkbox-control">
              <label class="switch">
                <input type="checkbox" id="useMouthCnn" />
                <span class="slider"></span>
              </label>
              <span>Enable Mouth Classifier</span>
            </div>
          </div>
        </details>

        <!-- Head Tilt Settings -->
        <details class="accordion">
          <summary class="accordion-header">
            <span class="accordion-icon">ğŸ”„</span>
            <span>Head Tilt Detection</span>
          </summary>
          <div class="accordion-content">
            <div class="control">
              <label for="tiltThresh">Tilt Threshold (deg) <span id="tiltThreshVal" class="value-badge">12</span></label>
              <input type="range" id="tiltThresh" min="5" max="30" step="1" value="12" />
            </div>
            <div class="control">
              <label for="tiltCooldown">Tilt Cooldown (sec) <span id="tiltCooldownVal" class="value-badge">2.5</span></label>
              <input type="range" id="tiltCooldown" min="0.5" max="5.0" step="0.1" value="2.5" />
            </div>
          </div>
        </details>

        <!-- Yawn Detection -->
        <details class="accordion">
          <summary class="accordion-header">
            <span class="accordion-icon">ğŸ¥±</span>
            <span>Yawn Detection</span>
          </summary>
          <div class="accordion-content">
            <div class="control">
              <label for="yawnThresh">Yawn Probability <span id="yawnThreshVal" class="value-badge">0.60</span></label>
              <input type="range" id="yawnThresh" min="0.25" max="0.95" step="0.01" value="0.60" />
            </div>
            <div class="control">
              <label for="yawnCooldown">Yawn Cooldown (sec) <span id="yawnCooldownVal" class="value-badge">3.0</span></label>
              <input type="range" id="yawnCooldown" min="1.0" max="10.0" step="0.5" value="3.0" />
            </div>
            <div class="control">
              <label for="yawnMorMin">Min Mouth Opening <span id="yawnMorMinVal" class="value-badge">0.35</span></label>
              <input type="range" id="yawnMorMin" min="0.20" max="0.70" step="0.01" value="0.35" />
            </div>
            <div class="control">
              <label for="yawnMinDur">Min Duration (sec) <span id="yawnMinDurVal" class="value-badge">0.5</span></label>
              <input type="range" id="yawnMinDur" min="0.1" max="2.0" step="0.1" value="0.5" />
            </div>
          </div>
        </details>

        <!-- Debug Mode -->
        <details class="accordion">
          <summary class="accordion-header">
            <span class="accordion-icon">ğŸ•·ï¸</span>
            <span>Debug / Capture</span>
          </summary>
          <div class="accordion-content">
            <div class="control checkbox-control">
              <label class="switch">
                <input type="checkbox" id="captureMode" />
                <span class="slider"></span>
              </label>
              <span>Dataset Capture Mode</span>
            </div>
            <p class="hint">Press n/o/s/y keys to save crops</p>
          </div>
        </details>
      </aside>

      <!-- Main Content -->
      <section class="main-content">
        <!-- Video Stage -->
        <div class="video-stage">
          <div class="gothic-frame">
            <div class="frame-corner corner-tl">
              <svg width="80" height="80" viewBox="0 0 80 80"><path d="M0,20 Q0,0 20,0 L0,0 Z M0,40 L0,80 L10,80 L10,45 Z M20,0 L60,0 L60,10 L25,10 Z" fill="currentColor"/></svg>
            </div>
            <div class="frame-corner corner-tr">
              <svg width="80" height="80" viewBox="0 0 80 80"><path d="M60,0 Q80,0 80,20 L80,0 Z M40,0 L0,0 L0,10 L35,10 Z M80,40 L80,80 L70,80 L70,45 Z" fill="currentColor"/></svg>
            </div>
            <div class="frame-corner corner-bl">
              <svg width="80" height="80" viewBox="0 0 80 80"><path d="M0,60 Q0,80 20,80 L0,80 Z M0,40 L0,0 L10,0 L10,35 Z M20,80 L60,80 L60,70 L25,70 Z" fill="currentColor"/></svg>
            </div>
            <div class="frame-corner corner-br">
              <svg width="80" height="80" viewBox="0 0 80 80"><path d="M60,80 Q80,80 80,60 L80,80 Z M40,80 L0,80 L0,70 L35,70 Z M80,40 L80,0 L70,0 L70,35 Z" fill="currentColor"/></svg>
            </div>
            <!-- Spider web decorations -->
            <div class="spiderweb spiderweb-tl">ğŸ•¸ï¸</div>
            <div class="spiderweb spiderweb-tr">ğŸ•¸ï¸</div>
            <div class="halloween-icon bat-1">ğŸ¦‡</div>
            <div class="halloween-icon bat-2">ğŸ¦‡</div>
            <div class="halloween-icon spider">ğŸ•·ï¸</div>
          </div>
          <div class="videoWrap">
            <video id="video" playsinline></video>
            <canvas id="output"></canvas>
          </div>
        </div>

        <!-- Status Panel -->
        <div class="status-panel">
          <div class="status-header">
            <span class="pulse-icon">ğŸ’€</span>
            <h3>Vital Signs</h3>
          </div>
          <div class="status-grid">
            <div class="stat-item">
              <span class="stat-label">State</span>
              <span id="state" class="stat-value badge-idle">idle</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Target Face</span>
              <span id="targetFace" class="stat-value">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">EAR Left</span>
              <span id="earL" class="stat-value mono">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">EAR Right</span>
              <span id="earR" class="stat-value mono">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">CNN Left</span>
              <span id="cnnL" class="stat-value mono">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">CNN Right</span>
              <span id="cnnR" class="stat-value mono">-</span>
            </div>
            <div class="stat-item full-width">
              <span class="stat-label">Mouth State</span>
              <span id="mouthPred" class="stat-value">-</span>
            </div>
            <div class="stat-item full-width">
              <span class="stat-label">Eyes Closed Duration</span>
              <span id="closedTime" class="stat-value danger">0.0s</span>
            </div>
          </div>
          <div id="msg" class="alert-message"></div>
          <div class="hints">
            <p class="hint">ğŸ’¡ Click face box or use â†/â†’ to select target</p>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="cobweb cobweb-left">ğŸ•¸ï¸</div>
      <p>ğŸ”’ Camera stays on-device â€¢ No data uploaded</p>
      <p class="tech-stack">Powered by MediaPipe Face Mesh Ã— TensorFlow.js</p>
      <div class="cobweb cobweb-right">ğŸ•¸ï¸</div>
    </div>
  </footer>

  <!-- MediaPipe libs (no build needed) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <!-- TensorFlow.js for CNN eye classifier -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>

  <script src="app.js?v=2"></script>
</body>
</html>
